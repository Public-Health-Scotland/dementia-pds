---
title: "ADDITIONAL ANALYSIS DRAFT"
output: 
  flexdashboard::flex_dashboard:
    logo: phs-logo.png
    orientation: rows
    vertical_layout: scroll
---

```{r load-setup, include=FALSE}
source(here::here("code", "00_setup-environment.R"))
library(crosstalk) # for drop down menus
library(phsstyles)
library(htmltools)

# Write numbers with thousands separator
knit_hooks$set(inline = function(x){
  if(!is.character(x)){prettyNum(x, big.mark=",")}else{x}
})
```

---
date: "`r paste('Data as at', format(end_date, '%d %B %Y'))`"
---

```{r setup, include=FALSE}

# Remove tidylog
detach("package:tidylog", unload = TRUE)

# Load functions
walk(dir(here::here("functions"), full.names = TRUE), source)


# Load PDS data
pds <- read_rds(get_mi_data_path("final_data", ext = "rds", test_output = test_output)) %>% 
  
  # Remove codes from board and IJB
  mutate(health_board = str_sub(health_board, 3, -1),
         ijb          = if_else(is.na(ijb),
                                "Unknown",
                                str_sub(ijb, 11, -1)))

# Load expected diagnoses reference file
exp <- read_csv(get_exp_diagnoses_path())


# Load error summary
err <- read_rds(get_mi_data_path("error_data", ext = "rds", test_output = test_output)) %>% 

  mutate(ijb = if_else(is.na(ijb),
                                "Unknown",
                                str_sub(ijb, 11, -1)))

# calculate final data referrals for Scotland and health boards
pds_ijb <- pds %>% arrange(ijb)

pds_scot <- pds %>% group_by(health_board = "Scotland", ijb = "Scotland", fy, month, ldp_full, ldp, age_grp_2, age_grp, simd, sex) %>%   summarise(referrals = sum(referrals), .groups = "drop")

pds_hb <- pds %>% group_by(health_board, fy, month, ldp_full, ldp, age_grp_2, age_grp, simd, sex) %>% 
  summarise(referrals = sum(referrals), .groups = "drop") %>% mutate(ijb = health_board, .before = fy)

# combine data for ijb, hb and Scotland
pds_all <- bind_rows(pds_scot, pds_hb, pds_ijb)

pds_all %<>% rename(geog = ijb) 

pds_all$geog<- factor(pds_all$geog, levels = unique(pds_all$geog))


#create year lists
provisional_year <- paste0(as.numeric(substr(last(finalised_years),1,4)) + 1,
                           "/", as.numeric(substr(last(finalised_years),6,7)) + 1)

current_fy <- paste0(substr(fy,1,4),
                           "/", as.numeric(substr(fy,3,4)) + 1)

last_full_year <- if_else(qt == 4, current_fy, paste0(as.numeric(substr(fy,1,4)) - 1,
                           "/", as.numeric(substr(fy,3,4))))

all_years <- unique(pds_all$fy)

if(qt == 4){full_years = all_years}else{full_years = all_years[-length(all_years)]}


```
<!-- delete all of above when finished testing -->


```{r data setup-demo, include=FALSE}
#prepare subtype of dementia data
subtype_data <- read_rds(get_mi_data_path("subtype_data", ext = "rds", test_output = test_output))

pds_all_subtype <- subtype_data %>% filter(age_grp_2 == "All") %>% 
  select(geog, fy, subtype, total_referrals)

pds_all_subtype$geog <- factor(pds_all_subtype$geog, levels = unique(pds_all$geog))

pds_all_subtype$geog <- factor(pds_all_subtype$geog, levels = unique(pds_all$geog))

pds_all_subtype$subtype <- factor(pds_all_subtype$subtype, levels = c(unique(pds_all_subtype$subtype)[-6],unique(pds_all_subtype$subtype)[6]))

ldp_all_subtype <- subtype_data %>% filter(age_grp_2 == "All") %>%
  select(-health_board, -age_grp_2, -total_referrals) %>% 
  complete(nesting(geog, fy), subtype, fill = list(perc_met = NA))

ldp_all_subtype <- left_join(ldp_all_subtype,
ldp_all_subtype %>% filter(geog == "Scotland") %>% select(fy, subtype, perc_met) %>% 
  rename(scot_perc_met = perc_met))

ldp_all_subtype$geog<- factor(ldp_all_subtype$geog, levels = unique(pds_all$geog))

ldp_all_subtype$subtype <- factor(ldp_all_subtype$subtype, levels = c(unique(ldp_all_subtype$subtype)[-6],unique(ldp_all_subtype$subtype)[6]))

# prepare stage of illness data
stage_data <- read_rds(get_mi_data_path("stage_data", ext = "rds", test_output = test_output))

pds_all_stage <- stage_data %>% filter(age_grp_2 == "All") %>% 
  select(geog, fy, stage, total_referrals)

pds_all_stage$geog <- factor(pds_all_stage$geog, levels = unique(pds_all$geog))

pds_all_stage$geog <- factor(pds_all_stage$geog, levels = unique(pds_all$geog))

pds_all_stage$stage <- factor(pds_all_stage$stage, 
    levels = c(unique(pds_all_stage$stage)[1],unique(pds_all_stage$stage)[3],unique(pds_all_stage$stage)[2],unique(pds_all_stage$stage)[5],unique(pds_all_stage$stage)[4]))
                              
ldp_all_stage <- stage_data %>% filter(age_grp_2 == "All") %>%
  select(-health_board, -age_grp_2, -total_referrals) %>% 
  complete(nesting(geog, fy), stage, fill = list(perc_met = NA))

ldp_all_stage <- left_join(ldp_all_stage,
ldp_all_stage %>% filter(geog == "Scotland") %>% select(fy, stage, perc_met) %>% 
  rename(scot_perc_met = perc_met))

ldp_all_stage$geog<- factor(ldp_all_stage$geog, levels = unique(pds_all$geog))

ldp_all_stage$stage <- factor(ldp_all_stage$stage, 
    levels = c(unique(ldp_all_stage$stage)[1],unique(ldp_all_stage$stage)[3],unique(ldp_all_stage$stage)[2],unique(ldp_all_stage$stage)[5],unique(ldp_all_stage$stage)[4]))
                              

#prepare model of care data
model_data <- read_rds(get_mi_data_path("model_data", ext = "rds", test_output = test_output))

pds_all_model <- model_data %>% filter(age_grp_2 == "All") %>% 
  select(geog, fy, model, total_referrals)

pds_all_model$geog <- factor(pds_all_model$geog, levels = unique(pds_all$geog))

pds_all_model$geog <- factor(pds_all_model$geog, levels = unique(pds_all$geog))

pds_all_model$model <- factor(pds_all_model$model, 
    levels = c(unique(pds_all_model$model)[-1],unique(pds_all_model$model)[1]))
                              
ldp_all_model <- model_data %>% filter(age_grp_2 == "All") %>%
  select(-health_board, -age_grp_2, -total_referrals) %>% 
  complete(nesting(geog, fy), model, fill = list(perc_met = NA))

ldp_all_model <- left_join(ldp_all_model,
ldp_all_model %>% filter(geog == "Scotland") %>% select(fy, model, perc_met) %>% 
  rename(scot_perc_met = perc_met))

ldp_all_model$geog<- factor(ldp_all_model$geog, levels = unique(pds_all$geog))

ldp_all_model$model <- factor(ldp_all_model$model, 
    levels = c(unique(ldp_all_model$model)[-1],unique(ldp_all_model$model)[1]))

#load uptake decision data
uptake_data <- read_rds(get_mi_data_path("uptake_data", ext = "rds", test_output = test_output))

#load carer's support data
carer_data <- read_rds(get_mi_data_path("carer_data", ext = "rds", test_output = test_output))

 
```

Subtype of Dementia {data-navmenu="Additional Information"}
=================================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Subtype of Dementia - Proportions 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[**Proportions**](#subtype-of-dementia)</li>
  <li>[Outcomes](#subtype-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=1220}
----------------------------------------------------------------------

### **Integration Authority Areas**
```{r dropdown-prop-subtype-ijb}
pds_subtype_data_ijb <- SharedData$new(pds_all_subtype %>% filter(!grepl("NHS", geog)), key = ~fy, group = "subtype_prop_ijb")

data_filter_subtype_prop <- filter_select(id = "trend_filter_subtype_prop_ijb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_subtype_data_ijb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_subtype_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Subtype of Dementia and Integration Authority Area</h2>
```{r plot-prop-subtype-legend-ijb}
bscols(widths = c(1,6,NA),NULL,
div(style=css(marginBottom="-20px", marginLeft="-80px",width="190%",height="95px"), plot_prop_legend(pds_all_subtype %>% filter(geog == "Scotland"), measure = subtype, measure_text = "Subtype of Dementia: ")),NULL)
```

```{r plot-prop-subtype-ijb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_subtype_data_ijb, measure = subtype, measure_text = "Subtype of Dementia: ", xlabel = "Integration Authority Area")
)
)

```

```{r trend-table-prop-subtype-ijb}

pds_prop_table_data_ijb <- pds_all_subtype %>%
  arrange(subtype) %>% filter(!grepl("NHS", geog)) %>% group_by(geog, fy) %>% 
  mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>% ungroup() %>%   select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
             rename(`Subtype of Dementia` = subtype)

pds_prop_table_data_ijb[is.na(pds_prop_table_data_ijb)] <- "0%"


pds_prop_table_ijb <- SharedData$new(pds_prop_table_data_ijb, key = ~fy, group = "subtype_prop_ijb")

bscols(widths = 12,
       div(style = css(width="98%", height="540px", margin="15px"),
          DT::datatable(pds_prop_table_ijb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

### **Health Boards**

```{r dropdown-prop-subtype-hb}
pds_subtype_data_hb <- SharedData$new(pds_all_subtype %>% filter(grepl("NHS", geog) | geog == "Scotland"), key = ~fy, group = "subtype_prop_hb")

data_filter_subtype_prop <- filter_select(id = "trend_filter_subtype_prop_hb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_subtype_data_hb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_subtype_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Subtype of Dementia and Health Board </h2>
```{r plot-prop-subtype-legend-hb}
bscols(widths = c(1,6,NA),NULL,
div(style=css(marginBottom="-20px", marginLeft="-80px",width="180%",height="95px"), plot_prop_legend(pds_all_subtype %>% filter(geog == "Scotland"), measure = subtype, measure_text = "Subtype of Dementia: ")),NULL)
```

```{r plot-prop-subtype-hb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_subtype_data_hb, measure = subtype, measure_text = "Subtype of Dementia: ", xlabel = "Health Board")
)
)

```

```{r trend-table-prop-subtype-hb}

pds_prop_table_data_hb <- pds_all_subtype %>% 
  arrange(subtype) %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>%
  group_by(geog, fy) %>% 
    mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
    ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
    rename(`Subtype of Dementia` = subtype)

pds_prop_table_data_hb[is.na(pds_prop_table_data_hb)] <- "0%"


pds_prop_table_hb <- SharedData$new(pds_prop_table_data_hb, key = ~fy, group = "subtype_prop_hb")

bscols(widths = 12,
       div(style = css(width="98%", height="560px", margin="15px"),
          DT::datatable(pds_prop_table_hb, rownames = FALSE, extensions = "FixedColumns",
              options = list(psubtypeLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

Subtype Outcomes {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Subtype of Dementia - Outcomes 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[Proportions](#subtype-of-dementia)</li>
  <li>[**Outcomes**](#subtype-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**

Row {data-height=1070}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-ldp-subtype}

ldp_all_subtype_data <- SharedData$new(ldp_all_subtype, key = ~geog, group = "ldp_subtype")

data_filter_ldp_subtype <- filter_select(id = "filter_ldp_subtype",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = ldp_all_subtype_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ldp_subtype,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 15px">Percentage of referrals who received a minimum of one year’s PDS by Subtype of Dementia and Financial Year</h2>
```{r plot-ldp-subtype-legend}
bscols(widths = c(1,1,9,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_ldp_line_legend_1(ldp_all_subtype %>% filter(geog == "Scotland"), measure = subtype)),
      div(style = css(width="100%", height="24px", marginLeft="15px"),
plot_ldp_line_legend_2(ldp_all_subtype %>% filter(geog == "Scotland"), measure = subtype, measure_text = "Subtype of Dementia: ")),NULL
)

```

```{r plot-ldp-subtype}
bscols(widths = 12,
  div(style = css(width="98%", height="450px"),
plot_ldp_line(ldp_all_subtype_data, measure = subtype, measure_text = "Subtype of Dementia: ", ncol = 4, nrow = 2))
)

```


```{r table-ldp-subtype}

ldp_subtype_table_data <- ldp_all_subtype %>% 
   filter(!is.na(perc_met), fy %in% full_years) %>%
  select(geog, fy, subtype, perc_met) %>%
   mutate(perc_met = paste0(perc_met, "%")) %>% 
  pivot_wider(names_from = fy, values_from = perc_met) %>%
  arrange(geog,subtype) %>% 
   mutate(across(everything(), ~replace_na(.x, "-"))) %>% 
             rename(`Subtype of Dementia` = subtype)  


ldp_subtype_table <- SharedData$new(ldp_subtype_table_data, key = ~geog, group = "ldp_subtype")


bscols(widths = 12,
       div(style = css(width="97%", height="380px", margin="20px"),
DT::datatable(ldp_subtype_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right',
                                                    targets = 2:(length(full_years)+1))
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold")
        )
     )



```

Stage of Illness {data-navmenu="Additional Information"}
=====================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Clinical Impression of Stage of Illness - Proportions 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[**Proportions**](#stage-of-illness)</li>
  <li>[Outcomes](#stage-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=1090}
----------------------------------------------------------------------

### **Integration Authority Areas**
```{r dropdown-prop-stage-ijb}
pds_stage_data_ijb <- SharedData$new(pds_all_stage %>% filter(!grepl("NHS", geog)), key = ~fy, group = "stage_prop_ijb")

data_filter_stage_prop <- filter_select(id = "trend_filter_stage_prop_ijb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_stage_data_ijb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_stage_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Clinical Impression of Stage of Illness and Integration Authority Area</h2>
```{r plot-prop-stage-legend-ijb}

bscols(widths = 12,
div(id="stageproplegend", plot_prop_legend(pds_all_stage %>% filter(geog == "Scotland"), measure = stage, measure_text = "Stage of Illness: "), style="margin-bottom:-351px"))

```


```{r plot-prop-stage-ijb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_stage_data_ijb, measure = stage, measure_text = "Stage of Illness: ", xlabel = "Integration Authority Area")
)
)

```


```{r trend-table-prop-stage-ijb}

pds_prop_stage_table_data_ijb <- pds_all_stage %>% filter(!grepl("NHS", geog)) %>% 
arrange(stage) %>% group_by(geog, fy) %>% 
  mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>% ungroup() %>%   select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
             rename(`Stage of Illness` = stage)

pds_prop_stage_table_data_ijb[is.na(pds_prop_stage_table_data_ijb)] <- "0%"


pds_prop_stage_table_ijb <- SharedData$new(pds_prop_stage_table_data_ijb, key = ~fy, group = "stage_prop_ijb")

bscols(widths = 12,
       div(style = css(width="98%", height="400px", margin="15px"),
          DT::datatable(pds_prop_stage_table_ijb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

### **Health Boards**

```{r dropdown-prop-stage-hb}
pds_stage_data_hb <- SharedData$new(pds_all_stage %>% filter(geog == "Scotland" | grepl("NHS", geog)),
                                   key = ~fy, group = "stage_prop_hb")

data_filter_stage_prop <- filter_select(id = "trend_filter_stage_prop_hb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_stage_data_hb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_stage_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Clinical Impression of Stage of Illness and Health Board </h2>
```{r plot-prop-stage-legend-hb}

bscols(widths = 12,
div(id="stageproplegendhb", plot_prop_legend(pds_all_stage %>% filter(geog == "Scotland"), measure = stage, measure_text = "Stage of Illness: "), style="margin-bottom:-351px"))

```


```{r plot-prop-stage-hb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_stage_data_hb, measure = stage, measure_text = "Stage of Illness: ", xlabel = "Health Board")
)
)

```


```{r trend-table-prop-stage-hb}

pds_prop_stage_table_data_hb <- pds_all_stage %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>%
  arrange(stage) %>% 
  group_by(geog, fy) %>% 
    mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
    ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
    rename(`Stage of Illness` = stage)

pds_prop_stage_table_data_hb[is.na(pds_prop_stage_table_data_hb)] <- "0%"


pds_prop_stage_table_hb <- SharedData$new(pds_prop_stage_table_data_hb, key = ~fy, group = "stage_prop_hb")

bscols(widths = 12,
       div(style = css(width="98%", height="440px", margin="15px"),
          DT::datatable(pds_prop_stage_table_hb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                  )
            )
       )




```

Stage Outcomes {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Clinical Impression of Stage of Illness - Outcomes 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[Proportions](#stage-of-illness)</li>
  <li>[**Outcomes**](#stage-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**

Row {data-height=845}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-ldp-stage}

ldp_all_stage_data <- SharedData$new(ldp_all_stage %>% filter(fy %in% full_years), key = ~geog, group = "ldp_stage")

data_filter_ldp_stage <- filter_select(id = "filter_ldp_stage",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = ldp_all_stage_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ldp_stage,
       NULL)


```

<h2 style="margin-left: 50px; margin-top: 0px; margin-bottom: 20px">Percentage of referrals who received a minimum of one year’s PDS by Clinical Impression of Stage of Illness and Financial Year </h2>
```{r plot-ldp-stage-legend}
bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_ldp_line_legend_1(ldp_all_stage %>% filter(geog == "Scotland"), measure = stage)),
      div(style = css(width="170%", height="24px", marginLeft="15px"),
plot_ldp_line_legend_2(ldp_all_stage %>% filter(geog == "Scotland"), measure = stage, measure_text = "Stage of Illness:")),NULL
)

# bscols(widths = 12,
# div(id="ldpstagelegend",plot_ldp_stage_legend(ldp_all_stage), style="margin-bottom:-351px"))

```

```{r plot-ldp-stage}
bscols(widths = 12,
  div(style = css(width="98%", height="350px"),
plot_ldp_line(ldp_all_stage_data, measure = stage, measure_text = "Stage of Illness: "))
)

# bscols(widths = 12,
#   div(style = css(width="98%", height="385px"),
# plot_ldp_stage(ldp_all_stage_data))
# )

```


```{r table-ldp-stage}

ldp_stage_table_data <- ldp_all_stage %>% 
 filter(!is.na(perc_met), fy %in% full_years) %>%
  select(geog, fy, stage, perc_met) %>%
   mutate(perc_met = paste0(perc_met, "%")) %>% 
  pivot_wider(names_from = fy, values_from = perc_met) %>%
  arrange(geog, stage) %>% 
   mutate(across(everything(), ~replace_na(.x, "-"))) %>% 
             rename(`Stage of Illness` = stage) 


ldp_stage_table <- SharedData$new(ldp_stage_table_data, key = ~geog, group = "ldp_stage")


bscols(widths = 12,
       div(style = css(width="97%", height="255px", margin="20px"),
DT::datatable(ldp_stage_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right',
                                                    targets = 2:(length(full_years)+1))
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

Model of Care {data-navmenu="Additional Information"}
=====================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Model of Care - Proportions 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[**Proportions**](#model-of-care)</li>
  <li>[Outcomes](#model-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=1200}
----------------------------------------------------------------------

### **Integration Authority Areas**
```{r dropdown-prop-model-ijb}
pds_model_data_ijb <- SharedData$new(pds_all_model %>% filter(!grepl("NHS", geog)), key = ~fy, group = "model_prop_ijb")

data_filter_model_prop <- filter_select(id = "trend_filter_model_prop_ijb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_model_data_ijb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_model_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Model of Care and Integration Authority Area</h2>
```{r plot-prop-model-legend-ijb}
bscols(widths = c(1,6,NA),NULL,
div(style=css(marginBottom="-20px", marginLeft="-80px",width="180%",height="95px"), plot_prop_legend(pds_all_model %>% filter(geog == "Scotland"), measure = model, measure_text = "Model of Care: ")),NULL)

```


```{r plot-prop-model-ijb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_model_data_ijb, measure = model, measure_text = "Model of Care: ", xlabel = "Integration Authority Area")
)
)

```


```{r trend-table-prop-model-ijb}

pds_prop_model_table_data_ijb <- pds_all_model %>%
  arrange(model) %>% filter(!grepl("NHS", geog)) %>% group_by(geog, fy) %>% 
  mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>% ungroup() %>%   select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
             rename(`Model of Care` = model)

pds_prop_model_table_data_ijb[is.na(pds_prop_model_table_data_ijb)] <- "0%"


pds_prop_model_table_ijb <- SharedData$new(pds_prop_model_table_data_ijb, key = ~fy, group = "model_prop_ijb")

bscols(widths = 12,
       div(style = css(width="98%", height="500px", margin="15px"),
          DT::datatable(pds_prop_model_table_ijb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold"#, padding = "4px")
  )
            )
       )




```

### **Health Boards**

```{r dropdown-prop-model-hb}
pds_model_data_hb <- SharedData$new(pds_all_model %>% filter(geog == "Scotland" | grepl("NHS", geog)),
                                   key = ~fy, group = "model_prop_hb")

data_filter_model_prop <- filter_select(id = "trend_filter_model_prop_hb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_model_data_hb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_model_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Model of Care and Health Board </h2>
```{r plot-prop-model-legend-hb}
bscols(widths = c(1,6,NA),NULL,
div(style=css(marginBottom="-20px", marginLeft="-80px",width="180%",height="95px"), plot_prop_legend(pds_all_model %>% filter(geog == "Scotland"), measure = model, measure_text = "Model of Care: ")),NULL)


```


```{r plot-prop-model-hb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_model_data_hb, measure = model, measure_text = "Model of Care: ", xlabel = "Health Board")
)
)

```


```{r trend-table-prop-model-hb}

pds_prop_model_table_data_hb <- pds_all_model %>% 
  arrange(model) %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>%
  group_by(geog, fy) %>% 
    mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
    ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
    rename(`Model of Care` = model)

pds_prop_model_table_data_hb[is.na(pds_prop_model_table_data_hb)] <- "0%"


pds_prop_model_table_hb <- SharedData$new(pds_prop_model_table_data_hb, key = ~fy, group = "model_prop_hb")

bscols(widths = 12,
       div(style = css(width="98%", height="500px", margin="15px"),
          DT::datatable(pds_prop_model_table_hb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                  )
            )
       )




```

Model Outcomes {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Model of Care - Outcomes 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[Proportions](#model-of-care)</li>
  <li>[**Outcomes**](#model-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**

Row {data-height=950}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-ldp-model}

ldp_all_model_data <- SharedData$new(ldp_all_model %>% filter(fy %in% full_years), key = ~geog, group = "ldp_model")

data_filter_ldp_model <- filter_select(id = "filter_ldp_model",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = ldp_all_model_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ldp_model,
       NULL)


```

<h2 style="margin-left: 50px; margin-top: 0px; margin-bottom: 20px">Percentage of referrals who received a minimum of one year’s PDS by Model of Care and Financial Year </h2>
```{r plot-ldp-model-legend}
bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_ldp_line_legend_1(ldp_all_model %>% filter(geog == "Scotland"), measure = model)),
      div(style = css(width="170%", height="24px", marginLeft="15px"),
plot_ldp_line_legend_2(ldp_all_model %>% filter(geog == "Scotland"), measure = model, measure_text = "Model of Care:")),NULL
)

# bscols(widths = 12,
# div(id="ldpmodellegend",plot_ldp_model_legend(ldp_all_model), style="margin-bottom:-351px"))

```

```{r plot-ldp-model}
bscols(widths = 12,
  div(style = css(width="98%", height="400px"),
plot_ldp_line(ldp_all_model_data, measure = model, measure_text = "Model of Care: ", ncol = 3, nrow = 2))
)

# bscols(widths = 12,
#   div(style = css(width="98%", height="385px"),
# plot_ldp_model(ldp_all_model_data))
# )

```


```{r table-ldp-model}

ldp_model_table_data <- ldp_all_model %>% 
 filter(!is.na(perc_met), fy %in% full_years) %>%
  select(geog, fy, model, perc_met) %>%
   mutate(perc_met = paste0(perc_met, "%")) %>% 
  pivot_wider(names_from = fy, values_from = perc_met) %>%
  arrange(geog, model) %>% 
   mutate(across(everything(), ~replace_na(.x, "-"))) %>% 
             rename(`Model of Care` = model) 


ldp_model_table <- SharedData$new(ldp_model_table_data, key = ~geog, group = "ldp_model")


bscols(widths = 12,
       div(style = css(width="97%", height="300px", margin="20px"),
DT::datatable(ldp_model_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right',
                                                    targets = 2:(length(full_years)+1))
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```


Carer's Support {data-navmenu="Additional Information"}
=====================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Carer's Support 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=920}
----------------------------------------------------------------------

### **Health Boards**

```{r dropdown-carer-hb}

 table_hb_carer_data <- carer_data %>% 
      filter(age_grp_2 == "All", simd == "All") %>% 
      filter(ijb == "All" | ijb == "Scotland") %>% 
      pivot_wider(names_from = carers_support, values_from = referrals) %>% 
      mutate(across(where(is.numeric), ~ replace(., is.na(.), 0))) %>% 
      adorn_totals("col") %>% 
      select(3,1,9,8,6,7) %>% 
      mutate(perc_carer = paste0(round(100*Yes/Total,1), "%")) %>%
  rename("Number of People Referred to PDS" = "Total", 
             "Health Board" = "health_board",
              "Number of people with Carer's Support" = "Yes",
         "Number of people without Carer's Support" = "No",
         "Number of people where Carer's Support is Not Known" = "Not Known",
             "Percentage with Carer's Support" = "perc_carer")


table_hb_carer <- SharedData$new(table_hb_carer_data)

data_filter_carer_hb <- filter_select(id = "filter_carer_hb_year",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = table_hb_carer,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_carer_hb,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px">Number and percentage of individuals where PDS work is carried out in conjunction with the family/carer; Health Boards</h2>
```{r table-carer-hb}

bscols(widths = 12,
       div(style = css(width="98%", height="710px", margin="15px"),
          DT::datatable(table_hb_carer, rownames = FALSE,
              options = list(pageLength = 15,
                             scrollX = FALSE,
                             scrollY = TRUE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:6)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )


```

### **Integration Authority Areas**

```{r dropdown-carer-ijb}

 table_ijb_carer_data <- carer_data %>% 
      filter(age_grp_2 == "All", simd == "All") %>% 
      mutate(ijb = if_else(health_board == "Scotland", "AAA", ijb)) %>%
      arrange(ijb) %>% 
      filter(ijb != "All") %>% 
      mutate(ijb = if_else(ijb == "AAA", "Scotland", ijb)) %>%
        pivot_wider(names_from = carers_support, values_from = referrals) %>% 
      mutate(across(where(is.numeric), ~ replace(., is.na(.), 0))) %>% 
      adorn_totals("col") %>% 
      select(3,2,9,8,6,7) %>% 
      mutate(perc_carer = paste0(round(100*Yes/Total,1), "%")) %>%
  rename("Number of People Referred to PDS" = "Total", 
             "Integration Authority Area" = "ijb",
              "Number of people with Carer's Support" = "Yes",
         "Number of people without Carer's Support" = "No",
         "Number of people where Carer's Support is Not Known" = "Not Known",
             "Percentage with Carer's Support" = "perc_carer")


table_ijb_carer <- SharedData$new(table_ijb_carer_data)

data_filter_carer_ijb <- filter_select(id = "filter_carer_ijb_year",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = table_ijb_carer,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_carer_ijb,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px">Number and percentage of individuals where PDS work is carried out in conjunction with the family/carer; Integration Authority Areas</h2>
```{r table-carer-ijb}



bscols(widths = 12,
       div(style = css(width="98%", height="710px", margin="15px"),
          DT::datatable(table_ijb_carer, rownames = FALSE,
              options = list(pageLength = 32,
                             scrollX = FALSE,
                             scrollY = TRUE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:6)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

Uptake Decision {data-navmenu="Additional Information"}
=====================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Uptake Decision 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=920}
----------------------------------------------------------------------

### **Health Boards**

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Referrals by PDS Uptake Decision, Health Boards</h2>
```{r dropdown-uptake-hb}

 table_hb_uptake_data <- uptake_data %>% 
      filter(age_grp_2 == "All", simd == "All") %>% 
      filter(ijb == "All" | ijb == "Scotland") %>% 
      pivot_wider(names_from = pds_uptake_decision, values_from = referrals) %>% 
      mutate(across(where(is.numeric), ~ replace(., is.na(.), 0))) %>% 
      adorn_totals("col") %>% 
      select(3,1,10,6,7,8,9) %>% 
      rowwise() %>% 
  mutate(perc_accepted = paste0(round(sum(c_across(4:5))/sum(c_across(3))*100,1), "%")) %>%       rename("Number of People Referred to PDS" = "Total", 
             "Health Board" = "health_board",
             "Percentage Accepted" = "perc_accepted")


table_hb_uptake <- SharedData$new(table_hb_uptake_data)

data_filter_uptake_hb <- filter_select(id = "filter_uptake_hb_year",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = table_hb_uptake,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_uptake_hb,
       NULL)

```

```{r table-uptake-hb}

bscols(widths = 12,
       div(style = css(width="98%", height="710px", margin="15px"),
          DT::datatable(table_hb_uptake, rownames = FALSE,
              options = list(pageLength = 15,
                             scrollX = FALSE,
                             scrollY = TRUE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:7)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )


```

### **Integration Authority Areas**

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Referrals by PDS Uptake Decision, Integration Authority Areas</h2>
```{r dropdown-uptake-ijb}

 table_ijb_uptake_data <- uptake_data %>% 
      filter(age_grp_2 == "All", simd == "All") %>% 
      mutate(ijb = if_else(health_board == "Scotland", "AAA", ijb)) %>%
      arrange(ijb) %>% 
      filter(ijb != "All") %>% 
      mutate(ijb = if_else(ijb == "AAA", "Scotland", ijb)) %>%
      pivot_wider(names_from = pds_uptake_decision, values_from = referrals) %>% 
      mutate(across(where(is.numeric), ~ replace(., is.na(.), 0))) %>% 
      adorn_totals("col") %>% 
      select(3,2,10,6,7,8,9) %>% 
      rowwise() %>% 
  mutate(perc_accepted = paste0(round(sum(c_across(4:5))/sum(c_across(3))*100,1), "%")) %>%       rename("Number of People Referred to PDS" = "Total",
             "Integration Authority Area" = "ijb",
             "Percentage Accepted" = "perc_accepted")

table_ijb_uptake <- SharedData$new(table_ijb_uptake_data)

data_filter_uptake_ijb <- filter_select(id = "filter_uptake_ijb_year",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = table_ijb_uptake,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_uptake_ijb,
       NULL)

```

```{r table-uptake-ijb}



bscols(widths = 12,
       div(style = css(width="98%", height="710px", margin="15px"),
          DT::datatable(table_ijb_uptake, rownames = FALSE,
              options = list(pageLength = 32,
                             scrollX = FALSE,
                             scrollY = TRUE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:7)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

```{js }
function filter_default() {

  document.getElementById("trend_filter_subtype_prop_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_subtype_prop_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_subtype_prop_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_subtype_prop_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_ldp_subtype").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_ldp_subtype").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("trend_filter_stage_prop_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_stage_prop_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_stage_prop_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_stage_prop_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_ldp_stage").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_ldp_stage").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_model_prop_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_model_prop_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_model_prop_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_model_prop_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_ldp_model").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_ldp_model").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
    document.getElementById("filter_carer_hb_year").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_carer_hb_year").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_carer_ijb_year").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_carer_ijb_year").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_uptake_hb_year").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_uptake_hb_year").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_uptake_ijb_year").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_uptake_ijb_year").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
 
  }
  
  window.onload = filter_default;

```

