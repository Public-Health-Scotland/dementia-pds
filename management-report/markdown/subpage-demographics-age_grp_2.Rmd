---
title: "DEMOGRAPHICS DRAFT"
output: 
  flexdashboard::flex_dashboard:
    logo: phs-logo.png
    orientation: rows
    vertical_layout: scroll
---

```{r load-setup, include=FALSE}
source(here::here("code", "00_setup-environment.R"))
library(crosstalk) # for drop down menus
library(phsstyles)
library(htmltools)

# Write numbers with thousands separator
knit_hooks$set(inline = function(x){
  if(!is.character(x)){prettyNum(x, big.mark=",")}else{x}
})
```

---
date: "`r paste('Data as at', format(end_date, '%d %B %Y'))`"
---

```{r setup, include=FALSE}

# Remove tidylog
detach("package:tidylog", unload = TRUE)

# Load functions
walk(dir(here::here("functions"), full.names = TRUE), source)

current_fy <- paste0(substr(fy,1,4),
                           "/", as.numeric(substr(fy,3,4)) + 1)

# Load PDS data
pds <- read_rds(get_mi_data_path("final_data", ext = "rds", test_output = test_output)) %>% 
  
  # Remove codes from board and IJB
  mutate(health_board = str_sub(health_board, 3, -1),
         ijb          = if_else(is.na(ijb),
                                "Unknown",
                                str_sub(ijb, 11, -1)))

# Load expected diagnoses reference file
exp <- read_csv(get_exp_diagnoses_path())


# Load error summary
err <- read_rds(get_mi_data_path("error_data", ext = "rds", test_output = test_output)) %>% 

  mutate(ijb = if_else(is.na(ijb),
                                "Unknown",
                                str_sub(ijb, 11, -1)))

# calculate final data referrals for Scotland and health boards
pds_ijb <- pds %>% arrange(ijb)

pds_scot <- pds %>% group_by(health_board = "Scotland", ijb = "Scotland", fy, month, ldp_full, ldp, age_grp_2, age_grp, simd, sex) %>%   summarise(referrals = sum(referrals), .groups = "drop")

pds_hb <- pds %>% group_by(health_board, fy, month, ldp_full, ldp, age_grp_2, age_grp, simd, sex) %>% 
  summarise(referrals = sum(referrals), .groups = "drop") %>% mutate(ijb = health_board, .before = fy)

# combine data for ijb, hb and Scotland
pds_all <- bind_rows(pds_scot, pds_hb, pds_ijb)

pds_all %<>% rename(geog = ijb) 

pds_all$geog<- factor(pds_all$geog, levels = unique(pds_all$geog))


```
<!-- delete all of above when finished testing -->


```{r data setup-demo, include=FALSE}
# to be automated based on whether current year is complete or not??
#included_years <- c("2016/17", "2017/18", "2018/19", "2019/20", "2020/21", "2021/22", "2022/23", "2023/24")


#prepare age data for LARGE AGE GROUPS
ldp_all_age_2 <- pds_all %>%
  filter(fy != "2024/25", age_grp_2 != "Unknown") %>%
  group_by(geog, fy, age_grp_2, ldp) %>%
  summarise(total_referrals = sum(referrals), .groups = "drop") %>% 
  pivot_wider(names_from = ldp, values_from = total_referrals, values_fill = 0) %>% 
  mutate(perc_met = round((complete + exempt)/(complete + exempt + fail)*100,1)) %>% 
complete(nesting(geog, fy), age_grp_2, fill = list(perc_met = NA))

ldp_all_age_2 <- left_join(ldp_all_age_2,
ldp_all_age_2 %>% filter(geog == "Scotland") %>% select(fy, age_grp_2, perc_met) %>% 
  rename(scot_perc_met = perc_met))

pds_all_age_2 <- pds_all %>% filter(age_grp_2 != "Unknown") #remove 6 unknowns from 2016/17 (add note to charts and tables?)

pds_all_age_2 %<>% group_by(fy, geog, age_grp_2) %>%
  summarise(total_referrals = sum(referrals), .groups = "drop")

#prepare population rate data with large age groups
pop_data <- read_rds("//conf/dementia/A&I/Outputs/management-report/lookups/pop_data.rds")
#above can be REMOVED when pages are linked (copied from subpage-trends)

pop_data_age_2 <- pop_data %>% filter(sex == "All", age_grp == "All") %>% select(-sex, -age_grp)

pds_all_age_2_cal_year <- pds_all_age_2 %>%
  mutate(year = as.numeric(substr(fy, 1, 4)))

pds_all_age_2_rates <- left_join(pds_all_age_2_cal_year, pop_data_age_2) %>% select(-year) %>%
  mutate(pop_rate_10000 = round((total_referrals/pop_est)*10000, 1)) %>% select(fy, geog, age_grp_2, pop_rate_10000)

pds_all_age_2_rates$geog<- factor(pds_all_age_2_rates$geog, levels = unique(pds_all_age_2_rates$geog))

pds_all_age_2_rates %<>% complete(nesting(fy, geog), age_grp_2, fill = list(pop_rate_10000 = 0)) 

pds_age_rates_2_data <- left_join(pds_all_age_2_rates,
pds_all_age_2_rates %>% filter(geog == "Scotland") %>% select(fy, age_grp_2, pop_rate_10000) %>% rename(scot_pop_rate_10000 = pop_rate_10000))

#prepare age data for SMALL AGE GROUPS
pds_all_age <- pds_all %>% filter(age_grp != "Unknown") #remove 6 unknowns from 2016/17 (add note to charts and tables?)

pds_all_age %<>% group_by(fy, geog, age_grp) %>%
  summarise(total_referrals = sum(referrals), .groups = "drop")


#prepare population rate data with small age groups
pop_data_age <- pop_data %>% filter(sex == "All", age_grp_2 == "All") %>% select(-sex, -age_grp_2)

pds_all_age_totals <- bind_rows(pds_all_age,
pds_all_age %>% group_by(fy, geog, age_grp = "All") %>% summarise(total_referrals = sum(total_referrals), .groups = "drop"))

pds_all_age_cal_year <- pds_all_age_totals %>%
  mutate(year = as.numeric(substr(fy, 1, 4)))

pds_all_age_rates <- left_join(pds_all_age_cal_year, pop_data_age) %>% select(-year) %>%
  mutate(pop_rate_10000 = round((total_referrals/pop_est)*10000, 1)) %>% select(fy, geog, age_grp, pop_rate_10000)

pds_all_age_rates$geog<- factor(pds_all_age_rates$geog, levels = unique(pds_all_age_rates$geog))

pds_all_age_rates %<>% complete(nesting(fy, geog), age_grp, fill = list(pop_rate_10000 = 0)) 

pds_age_rates_data <- left_join(pds_all_age_rates,
pds_all_age_rates %>% filter(geog == "Scotland") %>% select(fy, age_grp, pop_rate_10000) %>% rename(scot_pop_rate_10000 = pop_rate_10000))


#prepare gender data

ldp_all_sex <- pds_all %>%
  filter(fy != "2024/25", sex != "98 Not Specified", sex != "99 Not Known", sex != "Unknown") %>% #need note about how many unknowns have been removed
  group_by(geog, fy, sex, ldp) %>%
  summarise(total_referrals = sum(referrals), .groups = "drop") %>% 
  pivot_wider(names_from = ldp, values_from = total_referrals, values_fill = 0) %>% 
  mutate(perc_met = round((complete + exempt)/(complete + exempt + fail)*100,1)) %>% 
complete(nesting(geog, fy), sex, fill = list(perc_met = NA))

ldp_all_sex <- left_join(ldp_all_sex,
ldp_all_sex %>% filter(geog == "Scotland") %>% select(fy, sex, perc_met) %>% 
  rename(scot_perc_met = perc_met)) %>% mutate(sex = substring(sex, 4))

ldp_all_sex$sex<- factor(ldp_all_sex$sex, levels = c("Male", "Female"))

pds_all_sex <- pds_all %>% group_by(geog, fy, sex) %>% filter(sex != "98 Not Specified", sex != "99 Not Known", sex != "Unknown") %>% 
  summarise(total_referrals = sum(referrals), .groups = "drop") %>% 
complete(nesting(geog, fy), sex, fill = list(total_referrals = 0)) %>% mutate(sex = substring(sex, 4))

pds_all_sex$sex<- factor(pds_all_sex$sex, levels = c("Male", "Female"))

#prepare population rate data for gender

pop_data_sex <- pop_data %>% filter(age_grp == "All", age_grp_2 == "All", sex != "All") %>% select(-age_grp, -age_grp_2) %>% mutate(sex = substring(sex, 4))

pds_all_sex_cal_year <- pds_all_sex %>% 
  mutate(year = as.numeric(substr(fy, 1, 4)))

pds_all_sex_rates <- left_join(pds_all_sex_cal_year, pop_data_sex) %>% select(-year) %>%
  mutate(pop_rate_10000 = round((total_referrals/pop_est)*10000, 1))

pds_all_sex_rates$geog <- factor(pds_all_sex_rates$geog, levels = unique(pds_all_sex_rates$geog))
pds_all_sex_rates$sex <- as.factor(pds_all_sex_rates$sex)

pds_all_sex_rates %<>% complete(nesting(geog, fy), sex, fill = list(pop_est = NA, pop_rate_10000 = NA)) 

pds_all_sex_rates <- left_join(pds_all_sex_rates,
pds_all_sex_rates %>% filter(geog == "Scotland") %>% select(fy, sex, pop_rate_10000) %>% rename(scot_pop_rate_10000 = pop_rate_10000))

pds_all_sex_rates$sex<- factor(pds_all_sex_rates$sex, levels = c("Male", "Female"))


# with large age groups
ldp_all_sex_2 <- bind_rows(
  pds_all %>%
  filter(fy != "2024/25", sex != "98 Not Specified", sex != "99 Not Known", sex != "Unknown", age_grp_2 != "Unknown") %>%
  group_by(geog, fy, sex, age_grp_2, ldp) %>% 
    summarise(total_referrals = sum(referrals), .groups = "drop"),
  pds_all %>%
  filter(fy != "2024/25", sex != "98 Not Specified", sex != "99 Not Known", sex != "Unknown", age_grp_2 != "Unknown") %>% 
  group_by(geog, fy, sex, age_grp_2 = "All", ldp) %>% 
    summarise(total_referrals = sum(referrals), .groups = "drop"))%>% 
  pivot_wider(names_from = ldp, values_from = total_referrals, values_fill = 0) %>% 
  mutate(perc_met = round((complete + exempt)/(complete + exempt + fail)*100,1)) %>% 
complete(nesting(geog, fy), sex, fill = list(perc_met = NA))

ldp_all_sex_2 <- left_join(ldp_all_sex_2,
ldp_all_sex_2 %>% filter(geog == "Scotland") %>% select(fy, sex, age_grp_2, perc_met) %>% 
  rename(scot_perc_met = perc_met)) %>% mutate(sex = substring(sex, 4))

ldp_all_sex_2$age_grp_2<- factor(ldp_all_sex_2$age_grp_2, levels = c("All", "65+", "64 and Under"))
ldp_all_sex_2$sex<- factor(ldp_all_sex_2$sex, levels = c("Male", "Female"))


pds_all_sex_2 <- bind_rows(
  pds_all %>% group_by(geog, fy, sex, age_grp_2) %>% filter(sex != "98 Not Specified", sex != "99 Not Known", sex != "Unknown", age_grp_2 != "Unknown") %>% 
  summarise(total_referrals = sum(referrals), .groups = "drop"),
pds_all %>% group_by(geog, fy, sex, age_grp_2 = "All") %>% filter(sex != "98 Not Specified", sex != "99 Not Known", sex != "Unknown", age_grp_2 != "Unknown") %>% 
  summarise(total_referrals = sum(referrals), .groups = "drop")) %>% 
complete(nesting(geog, fy), sex, age_grp_2, fill = list(total_referrals = 0)) %>% mutate(sex = substring(sex, 4))


pds_all_sex_2$age_grp_2<- factor(pds_all_sex_2$age_grp_2, levels = c("All", "65+", "64 and Under"))
pds_all_sex_2$sex<- factor(pds_all_sex_2$sex, levels = c("Male", "Female"))


#prepare population rate data for gender with large age groups
pop_data_sex_2 <- pop_data %>% filter(age_grp == "All", sex != "All") %>% select(-age_grp) %>% mutate(sex = substring(sex, 4))

pds_all_sex_2_cal_year <- pds_all_sex_2 %>% 
  mutate(year = as.numeric(substr(fy, 1, 4)))

pds_all_sex_2_rates <- left_join(pds_all_sex_2_cal_year, pop_data_sex_2) %>% select(-year) %>%
  mutate(pop_rate_10000 = round((total_referrals/pop_est)*10000, 1))

pds_all_sex_2_rates$geog <- factor(pds_all_sex_2_rates$geog, levels = unique(pds_all_sex_2_rates$geog))
pds_all_sex_2_rates$sex <- as.factor(pds_all_sex_2_rates$sex)

pds_all_sex_2_rates %<>% complete(nesting(geog, fy), age_grp_2, sex, fill = list(pop_est = NA, pop_rate_10000 = NA)) 

pds_all_sex_2_rates <- left_join(pds_all_sex_2_rates,
pds_all_sex_2_rates %>% filter(geog == "Scotland") %>% select(fy, age_grp_2, sex, pop_rate_10000) %>% rename(scot_pop_rate_10000 = pop_rate_10000))

pds_all_sex_2_rates$sex<- factor(pds_all_sex_2_rates$sex, levels = c("Male", "Female"))

#prepare simd data

ldp_all_simd <- pds_all %>%
  filter(fy != "2024/25", simd != "Unknown") %>%
  group_by(geog, fy, simd, ldp) %>%
  summarise(total_referrals = sum(referrals), .groups = "drop") %>% 
  pivot_wider(names_from = ldp, values_from = total_referrals, values_fill = 0) %>% 
  mutate(perc_met = round((complete + exempt)/(complete + exempt + fail)*100,1)) %>% 
complete(nesting(geog, fy), simd, fill = list(perc_met = NA))

ldp_all_simd <- left_join(ldp_all_simd,
ldp_all_simd %>% filter(geog == "Scotland") %>% select(fy, simd, perc_met) %>% 
  rename(scot_perc_met = perc_met))

pds_all_simd <- pds_all %>% group_by(geog, fy, simd) %>% filter(simd != "Unknown") %>% 
  summarise(total_referrals = sum(referrals), .groups = "drop") %>% 
complete(nesting(geog, fy), simd, fill = list(total_referrals = 0))


#prepare population rate data with age groups
simd_pop_data <- read_rds("//conf/dementia/A&I/Outputs/management-report/lookups/simd_pop_data.rds")
#above can be REMOVED when pages are linked (copied from subpage-trends)

pop_data_simd <- simd_pop_data %>% filter(sex == "All", age_grp == "All", age_grp_2 == "All") %>% select(-sex, -age_grp, -age_grp_2)

pds_all_simd_cal_year <- pds_all_simd %>% 
  mutate(year = as.numeric(substr(fy, 1, 4)))

pds_all_simd_rates <- left_join(pds_all_simd_cal_year, pop_data_simd) %>% select(-year) %>%
  mutate(pop_rate_10000 = round((total_referrals/pop)*10000, 1))

pds_all_simd_rates$geog <- factor(pds_all_simd_rates$geog, levels = unique(pds_all_simd_rates$geog))
pds_all_simd_rates$simd <- as.factor(pds_all_simd_rates$simd)

pds_all_simd_rates %<>% complete(nesting(geog, fy), simd, fill = list(pop = NA, pop_rate_10000 = NA)) 

pds_all_simd_rates <- left_join(pds_all_simd_rates,
pds_all_simd_rates %>% filter(geog == "Scotland") %>% select(fy, simd, pop_rate_10000) %>% rename(scot_pop_rate_10000 = pop_rate_10000))
   
 
```
<!-- TO DO: consolidate above into data_prep file -->

Age Groups {data-navmenu="Demographics"}
=================================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Age Groups - Proportions 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[**Proportions**](#age-groups)</li>
  <li>[Rates per 10,000 population](#age-rates)</li>
  <li>[Outcomes](#age-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=1060}
----------------------------------------------------------------------

### **Health Boards**

```{r dropdown-prop-age-hb}
pds_age_data_hb <- SharedData$new(pds_all_age %>% filter(grepl("NHS", geog) | geog == "Scotland"), key = ~fy, group = "age_prop_hb")

data_filter_age_prop <- filter_select(id = "trend_filter_age_prop_hb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_age_data_hb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_age_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Age Group and Health Board </h2>
```{r plot-prop-age-legend-hb}

bscols(widths = 12,
div(id="ageproplegend", plot_prop_legend(pds_all_age %>% filter(geog == "Scotland"), measure = age_grp, measure_text = "Age Group: "), style="margin-bottom:-353px"))

```

```{r plot-prop-age-hb}
bscols(widths = 12,
  div(style = css(width="98%", height="420px"),
      plot_prop(pds_age_data_hb, measure = age_grp, measure_text = "Age Group: ", xlabel = "Health Board")
)
)

```

```{r trend-table-prop-age-hb}

pds_prop_table_data_hb <- pds_all_age %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>%
  group_by(geog, fy) %>% 
    mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
    ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
    rename(`Age Group` = age_grp)

pds_prop_table_data_hb[is.na(pds_prop_table_data_hb)] <- "0%"


pds_prop_table_hb <- SharedData$new(pds_prop_table_data_hb, key = ~fy, group = "age_prop_hb")

bscols(widths = 12,
       div(style = css(width="98%", height="440px", margin="15px"),
          DT::datatable(pds_prop_table_hb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold", padding = "4px"
                  )
            )
       )




```

### **Integration Authority Areas**
```{r dropdown-prop-age-ijb}
pds_age_data_ijb <- SharedData$new(pds_all_age %>% filter(!grepl("NHS", geog)), key = ~fy, group = "age_prop_ijb")

data_filter_age_prop <- filter_select(id = "trend_filter_age_prop_ijb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_age_data_ijb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_age_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Age Group and Integration Authority Area</h2>

```{r plot-prop-age-legend-ijb}

bscols(widths = 12,
div(id="ageproplegend", plot_prop_legend(pds_all_age %>% filter(geog == "Scotland"), measure = age_grp, measure_text = "Age Group: "), style="margin-bottom:-353px"))

```


```{r plot-prop-age-ijb}
bscols(widths = 12,
  div(style = css(width="98%", height="400px"),
      plot_prop(pds_age_data_ijb, measure = age_grp, measure_text = "Age Group: ", xlabel = "Integration Authority Area")
)
)

```


```{r trend-table-prop-age-ijb}

pds_prop_table_data_ijb <- pds_all_age %>% filter(!grepl("NHS", geog)) %>% group_by(geog, fy) %>% 
  mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>% ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
             rename(`Age Group` = age_grp)

pds_prop_table_data_ijb[is.na(pds_prop_table_data_ijb)] <- "0%"


pds_prop_table_ijb <- SharedData$new(pds_prop_table_data_ijb, key = ~fy, group = "age_prop_ijb")

bscols(widths = 12,
       div(style = css(width="98%", height="430px", margin="15px"),
          DT::datatable(pds_prop_table_ijb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold", padding = "4px"
                  )
            )
       )




```

Age Rates {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Age Groups - Rates per 10,000 population 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***
<ul>
  <li>[Proportions](#age-groups)</li>
  <li>[**Rates per 10,000 population**](#age-rates)</li>
  <li>[Outcomes](#age-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=770}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-trend-age_2-pop}

pds_pop_age_2_data <- SharedData$new(pds_age_rates_2_data,
  key = ~geog, group = "trend_age_2_pop")

data_filter_trend_age_2_pop <- filter_select(id = "filter_trend_age_2_pop",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = pds_pop_age_2_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_trend_age_2_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 15px"> Number of people referred to PDS per 10,000 population (18+) by Age Group and Financial Year</h2> 
```{r plot-trend-age_2-legend-pop}

bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_trend_rate_legend_1(pds_all_age_2_rates %>% filter(geog == "Scotland"), measure = age_grp_2)),
      div(style = css(width="90%", height="24px", marginLeft="15px"),
plot_trend_rate_legend_2(pds_all_age_2_rates %>% filter(geog == "Scotland"), measure = age_grp_2, measure_text = "Age Group:")),NULL
)

```

```{r plot-trend-age_2-pop}

bscols(widths = 12,
  div(style = css(width="98%", height="370px"),
plot_trend_rate(pds_pop_age_2_data, measure = age_grp_2, measure_text = "Age Group: ", y = "Rate per 10,000 Population", scales = "free_y"))
)

```

```{r table-trend-age_2-pop}

trend_pop_age_2_table_data <- pds_all_age_2_rates %>% filter(!is.na(pop_rate_10000)) %>% 
  select(geog,fy,age_grp_2,pop_rate_10000) %>%
  pivot_wider(names_from = fy, values_from = pop_rate_10000) %>%
             rename(`Age Group` = age_grp_2)


trend_pop_age_2_table <- SharedData$new(trend_pop_age_2_table_data, key = ~geog, group = "trend_age_2_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="130px", margin="20px"),
DT::datatable(trend_pop_age_2_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:9)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

### **Health Boards and Integration Authority Areas**

```{r dropdown-pop-age}

pds_age_pop_data <- SharedData$new(pds_age_rates_data %>% filter(geog != "Scotland") %>%
                                     mutate(key = paste0(geog,fy), .before = geog),
                                   key = ~key, group = "age_pop")

data_filter_pop_year <- filter_select(id = "filter_pop_age_year",
                                    label = "Select Financial Year:",
                                    group = ~fy,
                                    sharedData = pds_age_pop_data,
                                    multiple = FALSE
                                   )


data_filter_pop_hb_ijb <- filter_select(id = "filter_pop_age_hb_ijb",
                                    label = "Select Health Board/Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = pds_age_pop_data,
                                    multiple = FALSE
 
                                                                      )
bscols(widths = c(1,5,5,NA),
       NULL,
       data_filter_pop_year,
       data_filter_pop_hb_ijb,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 10px"> People referred to PDS per 10,000 population (18+) by Age Group</h2>
```{r plot-pop-age-legend}

age_pop_legend_data <- tibble(
  geog = c("Selected Health Board/Integration Authority Area", "Scotland"),
  y = c(0,0))

age_pop_legend_data$geog <- factor(age_pop_legend_data$geog, levels = unique(age_pop_legend_data$geog))


bscols(widths = c(3,6,NA),NULL,
div(style = css(width="1000px", height="23px"),plot_bar_age_pop_legend(age_pop_legend_data)),NULL
)
```

```{r plot-pop-age}

bscols(widths = 12,
       div(style = css(width="98%", height="380px"),
plot_bar_age_pop(pds_age_pop_data))
)

```

```{r table-pop-age}

pds_age_rates_table_data <- bind_rows(
  pds_age_rates_data %>% mutate(geog_2 = geog, .after = geog) %>%
  select(-scot_pop_rate_10000) %>%
  pivot_wider(names_from = age_grp, values_from = pop_rate_10000, values_fill = 0),
  pds_age_rates_data %>% mutate(geog_2 = "Scotland", .after = geog) %>%
  select(-pop_rate_10000) %>%
  pivot_wider(names_from = age_grp, values_from = scot_pop_rate_10000)) %>%
   filter(geog != "Scotland") %>%
    mutate(key = paste0(geog,fy), .before =fy)

pds_age_rates_table <- SharedData$new(pds_age_rates_table_data %>% rename(" " = geog_2),
                                     key = ~key, group = "age_pop")


bscols(widths = 12,
        div(style = css(width="98%", height="140px", margin="15px"),
DT::datatable(pds_age_rates_table, rownames = FALSE,
              options = list(pageLength = 2,
                             scrollX = FALSE,
                             scrollY = TRUE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0:2),
                                               list(className = 'dt-right', targets = 4:11)
                                               )
                             )
              )%>% 
          DT::formatStyle(1, fontWeight = "bold")
            )
       )

```

Age Outcomes {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Age Groups - Outcomes 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[Proportions](#age-groups)</li>
  <li>[Rates per 10,000 population](#age-rates)</li>
  <li>[**Outcomes**](#age-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**

Row {data-height=770}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-ldp-age_2}

ldp_all_age_2_data <- SharedData$new(ldp_all_age_2, key = ~geog, group = "ldp_age_2")

data_filter_ldp_age_2 <- filter_select(id = "filter_ldp_age_2",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = ldp_all_age_2_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ldp_age_2,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 15px"> Percentage of LDP standard achieved by Age Group and Financial Year</h2>
```{r plot-ldp-age_2-legend}
bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_ldp_line_legend_1(ldp_all_age_2 %>% filter(geog == "Scotland"), measure = age_grp_2)),
      div(style = css(width="75%", height="24px", marginLeft="15px"),
plot_ldp_line_legend_2(ldp_all_age_2 %>% filter(geog == "Scotland"), measure = age_grp_2, measure_text = "Age Group: ")),NULL
)

```

```{r plot-ldp-age_2}
bscols(widths = 12,
  div(style = css(width="98%", height="370px"),
plot_ldp_line(ldp_all_age_2_data, measure = age_grp_2, measure_text = "Age Group: "))
)

```


```{r table-ldp-age_2}

ldp_age_2_table_data <- ldp_all_age_2 %>% filter(!is.na(perc_met)) %>%
  select(geog, fy, age_grp_2, perc_met) %>%
   mutate(perc_met = paste0(perc_met, "%")) %>% 
  pivot_wider(names_from = fy, values_from = perc_met) %>%
             rename(`Age Group` = age_grp_2) 


ldp_age_2_table <- SharedData$new(ldp_age_2_table_data, key = ~geog, group = "ldp_age_2")


bscols(widths = 12,
       div(style = css(width="97%", height="125px", margin="20px"),
DT::datatable(ldp_age_2_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:9)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```


Gender {data-navmenu="Demographics"}
=================================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Gender - Proportions 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[**Proportions**](#gender)</li>
  <li>[Rates per 10,000 population](#gender-rates)</li>
  <li>[Outcomes](#gender-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=860}
----------------------------------------------------------------------

### **Health Boards**

```{r dropdown-prop-sex-hb}
pds_sex_data_hb <- SharedData$new(pds_all_sex_2 %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>% mutate(key = paste0(age_grp_2,fy)),
                                   key = ~key, group = "sex_prop_hb")

data_filter_sex_prop_hb <- filter_select(id = "filter_sex_prop_hb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_sex_data_hb,
                                    multiple = FALSE
                                   )

data_filter_age_prop_hb <- filter_select(id = "filter_sex_prop_age_hb",
                                    label = "Select Age Group:",
                                    group = ~age_grp_2,
                                    sharedData = pds_sex_data_hb,
                                    multiple = FALSE
                                   )

bscols(widths = c(1,4,4,NA),NULL,
data_filter_sex_prop_hb,
data_filter_age_prop_hb,NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Gender and Health Board </h2>

```{r plot-prop-sex-legend-hb}

bscols(widths = 12,
div(id="sexproplegend", plot_prop_legend(pds_all_sex %>% filter(geog == "Scotland"), measure = sex, measure_text = "Gender: "), style="margin-bottom:-351px"))

```


```{r plot-prop-sex-hb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop_2(pds_sex_data_hb, measure = sex, measure_text = "Gender: ", xlabel = "Health Board")
)
)

```


```{r trend-table-prop-sex-hb}

pds_prop_sex_table_data_hb <- pds_all_sex_2 %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>%
  mutate(key = paste0(age_grp_2,fy)) %>% 
  group_by(geog, fy, age_grp_2) %>% 
    mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
    mutate(perc_referrals = if_else(perc_referrals == "NaN%", "-", perc_referrals)) %>%
    ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
    rename(`Gender` = sex)

pds_prop_sex_table_data_hb[is.na(pds_prop_sex_table_data_hb)] <- "0%"


pds_prop_sex_table_hb <- SharedData$new(pds_prop_sex_table_data_hb, key = ~key, group = "sex_prop_hb")

bscols(widths = 12,
       div(style = css(width="98%", height="240px", margin="15px"),
          DT::datatable(pds_prop_sex_table_hb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = c(0,2,3)),
                                               list(className = 'dt-right', targets = 2:18)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

### **Integration Authority Areas**
```{r dropdown-prop-sex-ijb}
pds_sex_data_ijb <- SharedData$new(pds_all_sex_2 %>% filter(!grepl("NHS", geog)) %>% mutate(key = paste0(age_grp_2,fy)),
                                   key = ~key, group = "sex_prop_ijb")

data_filter_sex_prop_ijb <- filter_select(id = "filter_sex_prop_ijb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_sex_data_ijb,
                                    multiple = FALSE
                                   )

data_filter_age_prop_ijb <- filter_select(id = "filter_sex_prop_age_ijb",
                                    label = "Select Age Group:",
                                    group = ~age_grp_2,
                                    sharedData = pds_sex_data_ijb,
                                    multiple = FALSE
                                   )

bscols(widths = c(1,4,4,NA),NULL,
data_filter_sex_prop_ijb,
data_filter_age_prop_ijb,NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by Gender and Integration Authority Area</h2>
```{r plot-prop-sex-legend-ijb}

bscols(widths = 12,
div(id="sexproplegend", plot_prop_legend(pds_all_sex %>% filter(geog == "Scotland"), measure = sex, measure_text = "Gender: "), style="margin-bottom:-351px"))

```


```{r plot-prop-sex-ijb}
bscols(widths = 12,
  div(style = css(width="98%", height="400px"),
      plot_prop_2(pds_sex_data_ijb, measure = sex, measure_text = "Gender: ", xlabel = "Integration Authority Area")
)
)

```


```{r trend-table-prop-sex-ijb}

pds_prop_sex_table_data_ijb <- pds_all_sex_2 %>% filter(!grepl("NHS", geog)) %>%
  mutate(key = paste0(age_grp_2,fy)) %>% 
  group_by(geog, fy, age_grp_2) %>% 
  mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
  mutate(perc_referrals = if_else(perc_referrals == "NaN%", "-", perc_referrals)) %>%
  ungroup() %>%
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
             rename(`Gender` = sex)

pds_prop_sex_table_data_ijb[is.na(pds_prop_sex_table_data_ijb)] <- "0%"


pds_prop_sex_table_ijb <- SharedData$new(pds_prop_sex_table_data_ijb, key = ~key, group = "sex_prop_ijb")

bscols(widths = 12,
       div(style = css(width="98%", height="200px", margin="15px"),
          DT::datatable(pds_prop_sex_table_ijb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = c(0,2,3)),
                                               list(className = 'dt-right', targets = 2:35)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold")
            )
       )




```

Gender Rates {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Gender - Rates per 10,000 population 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***
<ul>
  <li>[Proportions](#gender)</li>
  <li>[**Rates per 10,000 population**](#gender-rates)</li>
  <li>[Outcomes](#gender-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=860}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-trend-sex-pop}

pds_pop_sex_data <- SharedData$new(pds_all_sex_rates,
  key = ~geog, group = "trend_sex_pop")

data_filter_trend_sex_pop <- filter_select(id = "filter_trend_sex_pop",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = pds_pop_sex_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_trend_sex_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 15px"> Number of people referred to PDS per 10,000 population by Gender and Financial Year</h2>
```{r plot-trend-sex-legend-pop}

bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_trend_rate_legend_1(pds_all_sex_rates %>% filter(geog == "Scotland"), measure = sex)),
      div(style = css(width="75%", height="24px", marginLeft="15px"),
plot_trend_rate_legend_2(pds_all_sex_rates %>% filter(geog == "Scotland"), measure = sex, measure_text = "Gender:")),NULL
)


```


```{r plot-trend-sex-pop}

bscols(widths = 12,
  div(style = css(width="98%", height="370px"),
plot_trend_rate(pds_pop_sex_data, measure = sex, measure_text = "Gender: ", y = "Rate per 10,000 Population"))
)

```


```{r table-trend-sex-pop}

trend_pop_sex_table_data <- pds_all_sex_rates %>% filter(!is.na(pop_rate_10000)) %>% 
  select(geog,fy,sex,pop_rate_10000) %>%
  pivot_wider(names_from = fy, values_from = pop_rate_10000) %>%
             rename(`Gender` = sex)


trend_pop_sex_table <- SharedData$new(trend_pop_sex_table_data, key = ~geog, group = "trend_sex_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="150px", margin="20px"),
DT::datatable(trend_pop_sex_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:9)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

### **Health Boards**

```{r dropdown-hb-sex-pop}
pds_hb_sex_rates <- pds_all_sex_rates %>% filter(geog == "Scotland" | grepl("NHS", geog)) 

pds_pop_sex_data_hb <- SharedData$new(pds_hb_sex_rates, key = ~fy, group = "hb_sex_pop")

data_filter_hb_sex_pop <- filter_select(id = "filter_hb_sex_pop",
                                    label = "Select Financial Year:",
                                    group = ~fy,
                                    sharedData = pds_pop_sex_data_hb,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_hb_sex_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Number of people referred to PDS per 10,000 population by Gender and Health Board</h2>
```{r plot-hb-sex-legend-pop}

 bscols(widths = 12,
 div(id="popsexlegendhb",plot_geog_bar_legend(pds_all_sex %>% filter(geog == "Scotland"), measure = sex), style="margin-bottom:-351px"))

```


```{r plot-hb-sex-pop}
bscols(widths = 12,
  div(style = css(width="98%", height="385px", marginBottom="-30px"),
plot_geog_bar(pds_pop_sex_data_hb, y_value = pop_rate_10000, measure = sex, measure_text = "Gender: ",
               x = "Health Board", y = "Rate per 10,000 Population"))
)

```


```{r table-hb-sex-pop}

hb_pop_sex_table_data <- pds_all_sex_rates %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>% 
  select(geog,fy,sex,pop_rate_10000) %>% mutate(pop_rate_10000 = as.character(pop_rate_10000)) %>% 
  pivot_wider(names_from = geog, values_from = pop_rate_10000, values_fill = "-") %>%
             rename(`Gender` = sex)


hb_sex_table_pop <- SharedData$new(hb_pop_sex_table_data, key = ~fy, group = "hb_sex_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="230px", margin="20px"),
DT::datatable(hb_sex_table_pop, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 5,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

### **Integration Authority Areas**

```{r dropdown-ijb-sex-pop}
pds_ijb_sex_rates <- pds_all_sex_rates %>% filter(!grepl("NHS", geog))

pds_pop_sex_data_ijb <- SharedData$new(pds_ijb_sex_rates, key = ~fy, group = "ijb_sex_pop")

data_filter_ijb_sex_pop <- filter_select(id = "filter_ijb_sex_pop",
                                    label = "Select Financial Year:",
                                    group = ~fy,
                                    sharedData = pds_pop_sex_data_ijb,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ijb_sex_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Number of people referred to PDS per 10,000 population by Gender and Integration Authority Area</h2>
```{r plot-ijb-sex-legend-pop}

 bscols(widths = 12,
 div(id="popsexlegendijb", plot_geog_bar_legend(pds_all_sex %>% filter(geog == "Scotland"), measure = sex), style="margin-bottom:-351px"))

```


```{r plot-ijb-sex-pop}
bscols(widths = 12,
  div(style = css(width="98%", height="385px", marginBottom="-30px"),
plot_geog_bar(pds_pop_sex_data_ijb, y_value = pop_rate_10000, measure = sex, measure_text = "Gender: ",
               x = "Integration Authority Area", y = "Rate per 10,000 Population"))
)

```


```{r table-ijb-sex-pop}

ijb_pop_sex_table_data <- pds_all_sex_rates %>%
  filter(!grepl("NHS", geog)) %>% 
  select(geog,fy,sex,pop_rate_10000) %>% mutate(pop_rate_10000 = as.character(pop_rate_10000)) %>% 
  pivot_wider(names_from = geog, values_from = pop_rate_10000, values_fill = "-") %>%
             rename(`Gender` = sex)


ijb_sex_table_pop <- SharedData$new(ijb_pop_sex_table_data, key = ~fy, group = "ijb_sex_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="220px", margin="20px"),
DT::datatable(ijb_sex_table_pop, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 5,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

Gender Outcomes {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Gender - Outcomes 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[Proportions](#gender)</li>
  <li>[Rates per 10,000 population](#gender-rates)</li>
  <li>[**Outcomes**](#gender-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**

Row {data-height=770}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-ldp-sex}

ldp_all_sex_data <- SharedData$new(ldp_all_sex, key = ~geog, group = "ldp_sex")

data_filter_ldp_sex <- filter_select(id = "filter_ldp_sex",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = ldp_all_sex_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ldp_sex,
       NULL)


```

<h2 style="margin-left: 50px; margin-top: 0px; margin-bottom: 20px"> Percentage of LDP standard achieved by Gender and Financial Year </h2>
```{r plot-ldp-sex-legend}
bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_ldp_line_legend_1(ldp_all_sex %>% filter(geog == "Scotland"), measure = sex)),
      div(style = css(width="90%", height="24px", marginLeft="15px"),
plot_ldp_line_legend_2(ldp_all_sex %>% filter(geog == "Scotland"), measure = sex, measure_text = "Gender:")),NULL
)

```

```{r plot-ldp-sex}
bscols(widths = 12,
  div(style = css(width="98%", height="370px"),
plot_ldp_line(ldp_all_sex_data, measure = sex, measure_text = "Gender: "))
)

```


```{r table-ldp-sex}

ldp_sex_table_data <- ldp_all_sex %>% filter(!is.na(perc_met)) %>%
  select(geog,fy,sex,perc_met) %>%
   mutate(perc_met = paste0(perc_met,"%")) %>% 
  pivot_wider(names_from = fy, values_from = perc_met) %>%
             rename(`Gender` = sex) 


ldp_sex_table <- SharedData$new(ldp_sex_table_data, key = ~geog, group = "ldp_sex")


bscols(widths = 12,
       div(style = css(width="97%", height="150px", margin="20px"),
DT::datatable(ldp_sex_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:9)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

Deprivation (SIMD) {data-navmenu="Demographics"}
=====================================

Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Deprivation - Proportions 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[**Proportions**](#deprivation-simd)</li>
  <li>[Rates per 10,000 population](#simd-rates)</li>
  <li>[Outcomes](#simd-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)


Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=980}
----------------------------------------------------------------------

### **Health Boards**

```{r dropdown-prop-simd-hb}
pds_simd_data_hb <- SharedData$new(pds_all_simd %>% filter(geog == "Scotland" | grepl("NHS", geog)),
                                   key = ~fy, group = "simd_prop_hb")

data_filter_simd_prop <- filter_select(id = "trend_filter_simd_prop_hb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_simd_data_hb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_simd_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by SIMD Quintile and Health Board </h2>
```{r plot-prop-simd-legend-hb}

bscols(widths = 12,
div(id="simdproplegend", plot_prop_legend(pds_all_simd %>% filter(geog == "Scotland"), measure = simd, measure_text = "SIMD Quintile: "), style="margin-bottom:-351px"))

```


```{r plot-prop-simd-hb}
bscols(widths = 12,
  div(style = css(width="98%", height="410px"),
      plot_prop(pds_simd_data_hb, measure = simd, measure_text = "SIMD Quintile: ", xlabel = "Health Board")
)
)

```


```{r trend-table-prop-simd-hb}

pds_prop_simd_table_data_hb <- pds_all_simd %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>%
  group_by(geog, fy) %>% 
    mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>%
    ungroup() %>% 
  select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
    rename(`SIMD Quintile` = simd)

pds_prop_simd_table_data_hb[is.na(pds_prop_simd_table_data_hb)] <- "0%"


pds_prop_simd_table_hb <- SharedData$new(pds_prop_simd_table_data_hb, key = ~fy, group = "simd_prop_hb")

bscols(widths = 12,
       div(style = css(width="98%", height="360px", margin="15px"),
          DT::datatable(pds_prop_simd_table_hb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                  )
            )
       )




```

### **Integration Authority Areas**
```{r dropdown-prop-simd-ijb}
pds_simd_data_ijb <- SharedData$new(pds_all_simd %>% filter(!grepl("NHS", geog)), key = ~fy, group = "simd_prop_ijb")

data_filter_simd_prop <- filter_select(id = "trend_filter_simd_prop_ijb",
                                    label = "Select Financial Year of Diagnosis:",
                                    group = ~fy,
                                    sharedData = pds_simd_data_ijb,
                                    multiple = FALSE
                                   )
bscols(widths = c(1,5,NA),
       NULL,
       data_filter_simd_prop,
       NULL)

```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Proportion of Referrals by SIMD Quintile and Integration Authority Area</h2>
```{r plot-prop-simd-legend-ijb}

bscols(widths = 12,
div(id="simdproplegend", plot_prop_legend(pds_all_simd %>% filter(geog == "Scotland"), measure = simd, measure_text = "SIMD Quintile: "), style="margin-bottom:-351px"))

```


```{r plot-prop-simd-ijb}
bscols(widths = 12,
  div(style = css(width="98%", height="400px"),
      plot_prop(pds_simd_data_ijb, measure = simd, measure_text = "SIMD Quintile: ", xlabel = "Integration Authority Area")
)
)

```


```{r trend-table-prop-simd-ijb}

pds_prop_simd_table_data_ijb <- pds_all_simd %>% filter(!grepl("NHS", geog)) %>% group_by(geog, fy) %>% 
  mutate(perc_referrals = paste0(round((total_referrals/sum(total_referrals))*100,0),"%")) %>% ungroup() %>%   select(-total_referrals) %>% 
  pivot_wider(names_from = geog, values_from = perc_referrals) %>%
             rename(`SIMD Quintile` = simd)

pds_prop_simd_table_data_ijb[is.na(pds_prop_simd_table_data_ijb)] <- "0%"


pds_prop_simd_table_ijb <- SharedData$new(pds_prop_simd_table_data_ijb, key = ~fy, group = "simd_prop_ijb")

bscols(widths = 12,
       div(style = css(width="98%", height="320px", margin="15px"),
          DT::datatable(pds_prop_simd_table_ijb, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                             ))) %>%
  DT::formatStyle(2, fontWeight = "bold", padding = "4px"
                  )
            )
       )




```

SIMD Rates {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Deprivation - Rates per 10,000 population 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***
<ul>
  <li>[Proportions](#deprivation-simd)</li>
  <li>[**Rates per 10,000 population**](#simd-rates)</li>
  <li>[Outcomes](#simd-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**


Row {.tabset data-height=965}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-trend-simd-pop}

pds_pop_simd_data <- SharedData$new(pds_all_simd_rates,
  key = ~geog, group = "trend_simd_pop")

data_filter_trend_simd_pop <- filter_select(id = "filter_trend_simd_pop",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = pds_pop_simd_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_trend_simd_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 15px"> Number of people referred to PDS per 10,000 population by SIMD Quintile and Financial Year</h2> 
```{r plot-trend-simd-legend-pop}

bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_trend_rate_legend_1(pds_all_simd_rates %>% filter(geog == "Scotland"), measure = simd)),
      div(style = css(width="170%", height="24px", marginLeft="15px"),
plot_trend_rate_legend_2(pds_all_simd_rates %>% filter(geog == "Scotland"), measure = simd, measure_text = "SIMD Quintile:")),NULL
)
# 
#  bscols(widths = 12,
#  div(id="popsimdlegend",plot_trend_simd_legend(pds_all_simd), style="margin-bottom:-355px"))

```


```{r plot-trend-simd-pop}

bscols(widths = 12,
  div(style = css(width="98%", height="370px"),
plot_trend_rate(pds_pop_simd_data, measure = simd, measure_text = "SIMD Quintile: ", y = "Rate per 10,000 Population"))
)

```


```{r table-trend-simd-pop}

trend_pop_simd_table_data <- pds_all_simd_rates %>% filter(!is.na(pop_rate_10000)) %>% 
  select(geog,fy,simd,pop_rate_10000) %>%
  pivot_wider(names_from = fy, values_from = pop_rate_10000) %>%
             rename(`SIMD Quintile` = simd)


trend_pop_simd_table <- SharedData$new(trend_pop_simd_table_data, key = ~geog, group = "trend_simd_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="235px", margin="20px"),
DT::datatable(trend_pop_simd_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:9)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

### **Health Boards**

```{r dropdown-hb-simd-pop}
pds_hb_simd_rates <- pds_all_simd_rates %>% filter(geog == "Scotland" | grepl("NHS", geog)) 

pds_pop_simd_data_hb <- SharedData$new(pds_hb_simd_rates, key = ~fy, group = "hb_simd_pop")

data_filter_hb_simd_pop <- filter_select(id = "filter_hb_simd_pop",
                                    label = "Select Financial Year:",
                                    group = ~fy,
                                    sharedData = pds_pop_simd_data_hb,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_hb_simd_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Number of people referred to PDS per 10,000 population by SIMD Quintile and Health Board</h2>
```{r plot-hb-simd-legend-pop}

 bscols(widths = 12,
 div(id="popsimdlegendhb", plot_geog_bar_legend(pds_all_simd %>% filter(geog == "Scotland"), measure = simd), style="margin-bottom:-351px"))

```


```{r plot-hb-simd-pop}
bscols(widths = 12,
  div(style = css(width="98%", height="385px", marginBottom="-30px"),
plot_geog_bar(pds_pop_simd_data_hb, y_value = pop_rate_10000, measure = simd, measure_text = "SIMD Quintile: ", x = "Health Board", y = "Rate per 10,000 Population"))
)

```


```{r table-hb-simd-pop}

hb_pop_simd_table_data <- pds_all_simd_rates %>% filter(geog == "Scotland" | grepl("NHS", geog)) %>% 
  select(geog,fy,simd,pop_rate_10000) %>% mutate(pop_rate_10000 = as.character(pop_rate_10000)) %>% 
  pivot_wider(names_from = geog, values_from = pop_rate_10000, values_fill = "-") %>%
             rename(`SIMD Quintile` = simd)


hb_simd_table_pop <- SharedData$new(hb_pop_simd_table_data, key = ~fy, group = "hb_simd_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="360px", margin="20px"),
DT::datatable(hb_simd_table_pop, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 5,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:16)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

### **Integration Authority Areas**

```{r dropdown-ijb-simd-pop}
pds_ijb_simd_rates <- pds_all_simd_rates %>% filter(!grepl("NHS", geog))

pds_pop_simd_data_ijb <- SharedData$new(pds_ijb_simd_rates, key = ~fy, group = "ijb_simd_pop")

data_filter_ijb_simd_pop <- filter_select(id = "filter_ijb_simd_pop",
                                    label = "Select Financial Year:",
                                    group = ~fy,
                                    sharedData = pds_pop_simd_data_ijb,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ijb_simd_pop,
       NULL)


```

<h2 style="margin-left: 70px; margin-top: 0px; margin-bottom: 0px"> Number of people referred to PDS per 10,000 population by SIMD Quintile and Integration Authority Area</h2>
```{r plot-ijb-simd-legend-pop}

 bscols(widths = 12,
 div(id="popsimdlegendijb", plot_geog_bar_legend(pds_all_simd %>% filter(geog == "Scotland"), measure = simd), style="margin-bottom:-351px"))

```


```{r plot-ijb-simd-pop}
bscols(widths = 12,
  div(style = css(width="98%", height="385px", marginBottom="-30px"),
plot_geog_bar(pds_pop_simd_data_ijb, y_value = pop_rate_10000, measure = simd, measure_text = "SIMD Quintile: ", x = "Integration Authority Area", y = "Rate per 10,000 Population"))
)

```


```{r table-ijb-simd-pop}

ijb_pop_simd_table_data <- pds_all_simd_rates %>%
  filter(!grepl("NHS", geog)) %>% 
  select(geog,fy,simd,pop_rate_10000) %>% mutate(pop_rate_10000 = as.character(pop_rate_10000)) %>% 
  pivot_wider(names_from = geog, values_from = pop_rate_10000, values_fill = "-") %>%
             rename(`SIMD Quintile` = simd)


ijb_simd_table_pop <- SharedData$new(ijb_pop_simd_table_data, key = ~fy, group = "ijb_simd_pop")


bscols(widths = 12,
       div(style = css(width="97%", height="340px", margin="20px"),
DT::datatable(ijb_simd_table_pop, rownames = FALSE, extensions = "FixedColumns",
              options = list(pageLength = 5,
                             scrollX = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:33)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

SIMD Outcomes {.hidden}
=====================================
Sidebar {.sidebar}
-----------------------------------------------------------------------

<br>

### Deprivation - Outcomes 

***

<font size="2"> 
<span style="color:red"> 
**MANAGEMENT INFORMATION ONLY:** <br>
**NOT FOR ONWARD DISTRIBUTION**
</span> </font>

***

<ul>
  <li>[Proportions](#deprivation-simd)</li>
  <li>[Rates per 10,000 population](#simd-rates)</li>
  <li>[**Outcomes**](#simd-outcomes)</li>
</ul>

***

Please get in touch with any comments, suggestions and feedback: [phs.dementiapds@phs.scot](mailto:phs.dementiapds@phs.scot)

Row
----------------------------------------------------------------------

### **Note**

**Please note that both the Dementia Post Diagnostic Support service provision and data submission to PHS were affected by the COVID-19 pandemic.**

Row {data-height=825}
----------------------------------------------------------------------

### **Trend by Financial Year**

```{r dropdown-ldp-simd}

ldp_all_simd_data <- SharedData$new(ldp_all_simd, key = ~geog, group = "ldp_simd")

data_filter_ldp_simd <- filter_select(id = "filter_ldp_simd",
                                    label = "Select Health Board or Integration Authority Area:",
                                    group = ~geog,
                                    sharedData = ldp_all_simd_data,
                                    multiple = FALSE
                                      )

bscols(widths = c(1,5,NA),
       NULL,
       data_filter_ldp_simd,
       NULL)


```

<h2 style="margin-left: 50px; margin-top: 0px; margin-bottom: 20px"> Percentage of LDP standard achieved by SIMD Quintile and Financial Year </h2>
```{r plot-ldp-simd-legend}
bscols(widths = c(1,1,5,NA),NULL,
       div(style = css(width="100px", height="20px"),
plot_ldp_line_legend_1(ldp_all_simd %>% filter(geog == "Scotland"), measure = simd)),
      div(style = css(width="170%", height="24px", marginLeft="15px"),
plot_ldp_line_legend_2(ldp_all_simd %>% filter(geog == "Scotland"), measure = simd, measure_text = "SIMD Quintile:")),NULL
)

# bscols(widths = 12,
# div(id="ldpsimdlegend",plot_ldp_simd_legend(ldp_all_simd), style="margin-bottom:-353px"))

```

```{r plot-ldp-simd}
bscols(widths = 12,
  div(style = css(width="98%", height="370px"),
plot_ldp_line(ldp_all_simd_data, measure = simd, measure_text = "SIMD Quintile: "))
)

# bscols(widths = 12,
#   div(style = css(width="98%", height="385px"),
# plot_ldp_simd(ldp_all_simd_data))
# )

```


```{r table-ldp-simd}

ldp_simd_table_data <- ldp_all_simd %>% filter(!is.na(perc_met)) %>%
  select(geog,fy,simd,perc_met) %>%
   mutate(perc_met = paste0(perc_met,"%")) %>% 
  pivot_wider(names_from = fy, values_from = perc_met) %>%
             rename(`SIMD Quintile` = simd) 


ldp_simd_table <- SharedData$new(ldp_simd_table_data, key = ~geog, group = "ldp_simd")


bscols(widths = 12,
       div(style = css(width="97%", height="235px", margin="20px"),
DT::datatable(ldp_simd_table, rownames = FALSE,
              options = list(pageLength = 10,
                             scrollX = TRUE,
                             scrollY = FALSE,
                             dom = "t",
                             ordering = FALSE,
                             columnDefs = list(list(visible = FALSE, targets = 0),
                                               list(className = 'dt-right', targets = 2:9)
                                               ))) %>%
           DT::formatStyle(2, fontWeight = "bold"#, padding = "4px"
                          )
        )
     )



```

```{js }
function filter_default() {

  document.getElementById("trend_filter_age_prop_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_age_prop_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_age_prop_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_age_prop_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_trend_age_2_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_trend_age_2_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_pop_age_year").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_pop_age_year").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_pop_age_hb_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("NHS Ayrshire & Arran", false);

  document.getElementById("filter_pop_age_hb_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_ldp_age_2").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_ldp_age_2").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_sex_prop_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_sex_prop_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_sex_prop_age_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("All", false);

  document.getElementById("filter_sex_prop_age_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_sex_prop_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_sex_prop_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_sex_prop_age_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("All", false);

  document.getElementById("filter_sex_prop_age_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_trend_sex_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_trend_sex_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_hb_sex_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_hb_sex_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
    document.getElementById("filter_ijb_sex_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_ijb_sex_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_ldp_sex").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_ldp_sex").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("trend_filter_simd_prop_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_simd_prop_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_simd_prop_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_simd_prop_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_trend_simd_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_trend_simd_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("filter_hb_simd_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_hb_simd_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
    document.getElementById("filter_ijb_simd_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("filter_ijb_simd_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("filter_ldp_simd").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("filter_ldp_simd").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
    document.getElementById("trend_filter_hb").getElementsByClassName("selectized") 
  [0].selectize.setValue("NHS Ayrshire & Arran", false);

  document.getElementById("trend_filter_hb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
   document.getElementById("trend_filter_ijb").getElementsByClassName("selectized") 
  [0].selectize.setValue("Aberdeen City", false);

  document.getElementById("trend_filter_ijb").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
 
   document.getElementById("trend_filter_pop").getElementsByClassName("selectized") 
  [0].selectize.setValue("Scotland", false);

  document.getElementById("trend_filter_pop").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  document.getElementById("trend_filter_year").getElementsByClassName("selectized") 
  [0].selectize.setValue("2023/24", false);

  document.getElementById("trend_filter_year").getElementsByClassName("selectized")
  [0].selectize.removeOption("");
  
  }
  
  window.onload = filter_default;

```

