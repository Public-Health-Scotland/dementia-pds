---
title: "Dementia PDS Quarterly Management Reports"
output: 
  flexdashboard::flex_dashboard:
    logo: isdscotland.png
    orientation: rows
    vertical_layout: scroll
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(stringr)
library(ggplot2)

health_boards <- c("NHS Ayrshire & Arran",
                   "NHS Borders",
                   "NHS Dumfries & Galloway",
                   "NHS Fife",
                   "NHS Grampian",
                   "NHS Greater Glasgow & Clyde",
                   "NHS Highland",
                   "NHS Lanarkshire",
                   "NHS Orkney",
                   "NHS Shetland",
                   "NHS Western Isles",
                   "NHS Lothian",
                   "NHS Tayside",
                   "NHS Forth Valley")

ldp <- c("success", "fail", "ongoing")

fy <- c("2016/17", "2017/18", "2018/19", "2019/20")

max_fy <- "2019/20"

nrows <- 1000

data <- tibble(
  health_board = sample(health_boards, nrows, replace = TRUE),
  ldp = sample(ldp, nrows, replace = TRUE),
  fy = sample(fy, nrows, replace = TRUE),
  referrals = sample(1:500, nrows, replace = TRUE)
)

```

Home
=================================================

Row
-------------------------------------------------

### About This Report

Bold text still to be automated.

This report contains data for diagnoses of dementia between **start date** and **end date** and is based on board submissions as of **month of board submission**.

These reports are developed by the NSS Public Health and Intelligence National Dementia PDS Team and contain performance-based analysis against the Scottish Government's LDP Standard on Dementia Post-Diagnostic Support whereby anyone newly diagnosed with dementia is entitled to a years worth of person-centred support.

We would welcome any comments or feedback you may have on these management reports. Please get in touch with the ISD Dementia PDS team at: [NSS.ISDDementiaPDS@nhs.net](mailto:NSS.ISDDementiaPDS@nhs.net)


Row
-------------------------------------------------

### LDP Standard

The Local Delivery Plan (LDP) standard is as follows:

People newly diagnosed with dementia will be offered a minimum of one year’s post-diagnostic support, coordinated by a named Link Worker.

Performance against the LDP standard is reported in two parts:

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

1. The percentage of people estimated to be newly diagnosed with dementia who were referred for post-diagnostic support.
2. The percentage of people referred who received a minimum of one year’s support.

</div>

<!-- Scotland -->

```{r render subpages_scotland, include=FALSE}

# Get all unique financial years for the subpages
years         <- sort(unique(data$fy))

# Create variable which stores all subpages outputs
out = NULL

# Set knitr options to allow duplicate labels (needed for the subpages)
options(knitr.duplicate.label = 'allow')

# Create temporary environment which we use for knitting subpages.RMD 
subpage_env <- new.env()

for(y in years){
    
  # Filter data for health board and financial year
  subpage_data <- data %>% 
    filter(fy == y)
  
  # Assign filtered data, health board and fy to subpage_env 
  assign("subpage_data", subpage_data, subpage_env)
  assign("health_board", "Scotland", subpage_env)
  assign("fy", y, subpage_env)
  assign("max_fy", max_fy, subpage_env) # To determine whether page is hidden
  assign("years", setdiff(years, y), subpage_env) # To add links to all FY pages
  
  # Knit subpage.RMD using the subpage_env and add result to out vector
  out = c(out, knitr::knit_child('subpage.Rmd', envir = subpage_env))
    
}
```

`r paste(knitr::knit_child(text = out), collapse = '')`


<!-- HEALTH BOARDS -->

```{r render subpages, include=FALSE}

# Get all unique health boards and financial years for the subpages
health_boards <- sort(unique(data$health_board))
years         <- sort(unique(data$fy))

# Create variable which stores all subpages outputs
out = NULL

# Set knitr options to allow duplicate labels (needed for the subpages)
options(knitr.duplicate.label = 'allow')

# Create temporary environment which we use for knitting subpages.RMD 
subpage_env <- new.env()

for (hb in health_boards) {
  for(y in years){
    
  # Filter data for health board and financial year
  subpage_data <- data %>% 
    filter(health_board == hb & fy == y)
  
  # Assign filtered data, health board and fy to subpage_env 
  assign("subpage_data", subpage_data, subpage_env)
  assign("health_board", hb, subpage_env)
  assign("fy", y, subpage_env)
  assign("max_fy", max_fy, subpage_env) # To determine whether page is hidden
  assign("years", setdiff(years, y), subpage_env) # To add links to all FY pages
  
  # Knit subpage.RMD using the subpage_env and add result to out vector
  out = c(out, knitr::knit_child('subpage.Rmd', envir = subpage_env))
    
  }
}
```

`r paste(knitr::knit_child(text = out), collapse = '')`


Methodology
=================================================

Row
-------------------------------------------------

### Methodology

Notes will be added here to describe the methodology.

The code used to produce these reports is available on [GitHub](https://github.com/alicebyers5/dementia-management-reports).